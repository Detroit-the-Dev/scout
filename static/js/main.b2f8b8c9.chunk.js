(this["webpackJsonpnew-york-open-data-explorer"]=this["webpackJsonpnew-york-open-data-explorer"]||[]).push([[0],{22:function(e,t,a){e.exports=a(35)},27:function(e,t,a){},28:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(18),o=a.n(c),s=(a(27),a(28),a(3)),l=a(19),u=a(1),i=a(9),m=a(12),d=a.n(m),f="http://api.us.socrata.com/api/catalog/v1?domains=data.cityofnewyork.us&search_context=data.cityofnewyork.us";function E(e){var t,a=arguments;return d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:100,n.abrupt("return",fetch("".concat(f,"&offset=").concat(e*t,"&limit=").concat(t)).then((function(e){return e.json()})));case 2:case"end":return n.stop()}}))}function g(e){return new Set([].concat(Object(u.a)(e.resource.columns_name),Object(u.a)(e.resource.columns_field_name)))}function p(e,t){var a=g(t),n=new Set(Object(u.a)(e).filter((function(e){return a.has(e)})));return Array.from(n)}var b=Object(n.createContext)(),h={datasets:[],tagList:[],categories:[],stateLoaded:!1},v=function(e,t){var a=t.type,n=t.payload;switch(a){case"UPDATE_OPEN_DATASET_MANIFEST":return Object(i.a)({},e,{datasets:n});case"UPDATE_TAGS":return Object(i.a)({},e,{tagList:n});case"UPDATE_CATEGORIES":return Object(i.a)({},e,{categories:n});case"HYDRATE_STATE":return Object(i.a)({},e,{},n);case"SET_LOADED":return Object(i.a)({},e,{stateLoaded:!0});default:return e}},j=function(){return Object(n.useContext)(b)};function O(e){var t=j(),a=Object(s.a)(t,1)[0].datasets;return console.log(e),Object(n.useMemo)((function(){return e?function(e,t){var a=g(e);return t.map((function(e){return{dataset:e,joinableColumns:p(a,e)}})).filter((function(t){return t.joinableColumns.length>0&&t.dataset.resource.id!==e.resource.id}))}(e,a):[]}),[e,a])}function y(e){var t=e.categories,a=e.selected,n=e.onChange;return r.a.createElement("div",{className:"category-selector"},r.a.createElement("h2",null,"Categories"),r.a.createElement("ul",{className:"category-list"},t.map((function(e){return r.a.createElement("li",{key:e,onClick:function(){return function(e){var t=a.includes(e)?a.filter((function(t){return t!==e})):[].concat(Object(u.a)(a),[e]);n(t)}(e)},className:"category-buttons ".concat(a&&a.includes(e)?"selected":"")},e)}))),a&&a.length>0&&r.a.createElement("button",{onClick:function(){n([])}},"clear"))}var N=a(10);function A(e){var t=e.dataset;return r.a.createElement("div",{className:"dataset",key:t.resource.id},r.a.createElement("h4",{className:"dataset-title"},r.a.createElement(N.b,{to:"/dataset/".concat(t.resource.id)},t.resource.name)),r.a.createElement("p",{className:"dataset-description"},t.resource.description),r.a.createElement("p",{className:"dataset-tags"},t.classification.domain_tags.join(", ")))}function S(e){var t=e.tags,a=e.selected,n=e.onChange;return r.a.createElement("div",{className:"tag-selector"},r.a.createElement("h2",null,"Tags"),t&&r.a.createElement("ul",{className:"tag-list"},t.map((function(e){return r.a.createElement("li",{className:a.includes(e)?"selected":"",onClick:function(){return function(e){console.log("old tags ",a);var t=a.includes(e)?a.filter((function(t){return t!==e})):[].concat(Object(u.a)(a),[e]);console.log("new tags ",t),n(t)}(e)},key:e},e)}))),a.length>0&&r.a.createElement("button",{onClick:function(){n([])}},"clear"))}function w(e){Object(l.a)(e);var t=function(){var e=j();return Object(s.a)(e,1)[0].categories}(),a=function(){var e=j();return Object(s.a)(e,1)[0].tagList}(),c=Object(n.useState)([]),o=Object(s.a)(c,2),i=o[0],m=o[1],d=Object(n.useState)([]),f=Object(s.a)(d,2),E=f[0],g=f[1],p=Object(n.useState)(""),b=Object(s.a)(p,2),h=b[0],v=b[1],O=function(e){var t=e.tags,a=e.term,r=e.categories,c=j(),o=Object(s.a)(c,1)[0].datasets;return Object(n.useMemo)((function(){var e=Object(u.a)(o);return t&&t.length>0&&(console.log("applting"),e=e.filter((function(e){return e.classification.domain_tags.filter((function(e){return t.includes(e)})).length>0}))),r&&r.length>0&&(e=e.filter((function(e){return e.classification.categories.filter((function(e){return r.includes(e)})).length>0}))),a&&a.length>0&&(e=e.filter((function(e){return e.resource.name.toLowerCase().includes(a.toLowerCase())}))),console.log("after term ",e.length),console.log("return size ",e.length),e}),[t,a,r,o])}({tags:i,categories:E,term:h}),N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=Object(n.useMemo)((function(){return e.length}),[e]);Object(n.useEffect)((function(){m(0)}),[e]);var c=Math.ceil(a/t),o=Object(n.useState)(0),l=Object(s.a)(o,2),i=l[0],m=l[1],d=Object(u.a)(Array(c)).map((function(e,t){return r.a.createElement("span",{className:t===i?"selected":"",onClick:function(){return m(t)}}," ",t+1," ")}));return[Object(n.useMemo)((function(){return e.slice(i*t,(i+1)*t)}),[t,i,e]),{pageButtons:d,setCurrentPageNo:m,currentPageNo:i}]}(O),w=Object(s.a)(N,2),T=w[0],_=w[1].pageButtons;return r.a.createElement("div",{className:"home-page"},r.a.createElement("div",{className:"categories"},r.a.createElement(y,{categories:t,onChange:g,selected:E})),r.a.createElement("div",{className:"tags"},r.a.createElement(S,{tags:a,selected:i,onChange:m})),r.a.createElement("div",{className:"datasets"},r.a.createElement("h2",null,"Datasets (",T.length," / ",O.length," )"),r.a.createElement("div",{className:"search"},r.a.createElement("input",{type:"text",onChange:function(e){return v(e.target.value)},value:h,placeholder:"search"})),r.a.createElement("ul",{className:"dataset-list"},T.map((function(e){return r.a.createElement(A,{dataset:e})}))),r.a.createElement("div",{className:"pagination"},_)))}function T(e){var t=function(e){var t=j();return Object(s.a)(t,1)[0].datasets.find((function(t){return t.resource.id===e}))}(e.match.params.datasetID),a=O(t);return r.a.createElement("div",{className:"dataset-page"},t?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"dataset-header"},r.a.createElement("h1",null,"Dataset ",t.resource.name),r.a.createElement("p",null,t.resource.description)),r.a.createElement("div",{className:"dataset-columns"},r.a.createElement("h2",null,"Columns"),r.a.createElement("ul",{className:"columns-list"},t.resource.columns_name.map((function(e,a){return r.a.createElement("li",null,e," : ",t.resource.columns_datatype[a])})))),r.a.createElement("div",{className:"dataset-joins"},r.a.createElement("h2",null,"Can be joined with"),r.a.createElement("ul",{style:{overflowY:"auto"}},a.map((function(e){return r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement(N.b,{to:"/dataset/".concat(e.dataset.resource.id)},e.dataset.resource.name," ")," ","on :"),r.a.createElement("p",null," ",e.joinableColumns.join(", ")))}))))):r.a.createElement("h1",null,"Loading..."))}var _=a(7);var C=function(){return r.a.createElement(N.a,{basename:"/NewYorkOpenDataExplorer"},r.a.createElement("div",{className:"App"},r.a.createElement(_.a,{path:"/",exact:!0,component:w}),r.a.createElement(_.a,{path:"/dataset/:datasetID",exact:!0,component:T})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement((function(e){var t=e.children,a=Object(n.useReducer)(v,h),c=Object(s.a)(a,2),o=c[0],l=c[1];return Object(n.useEffect)((function(){var e=localStorage.getItem("seralizedState");e?l({type:"HYDRATE_STATE",payload:Object(i.a)({},JSON.parse(e),{stateLoaded:!0})}):function(){var e,t,a;return d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d.a.awrap(E(0,1));case 2:return e=n.sent,t=e.resultSetSize,a=Math.ceil(t/100),n.abrupt("return",Promise.all(Object(u.a)(Array(a)).map((function(e,t){return E(t).then((function(e){return e.results}))}))).then((function(e){return e.reduce((function(e,t){return[].concat(Object(u.a)(t),Object(u.a)(e))}),[])})));case 6:case"end":return n.stop()}}))}().then((function(e){var t=function(e){var t=e.reduce((function(e,t){return[].concat(Object(u.a)(e),Object(u.a)(t.classification.domain_tags?t.classification.domain_tags:[]))}),[]);return Array.from(new Set(t))}(e),a=function(e){var t=e.reduce((function(e,t){return[].concat(Object(u.a)(e),Object(u.a)(t.classification.categories?t.classification.categories:[]))}),[]);return Array.from(new Set(t))}(e);l({type:"UPDATE_OPEN_DATASET_MANIFEST",payload:e}),l({type:"UPDATE_TAGS",payload:t}),l({type:"UPDATE_CATEGORIES",payload:a}),l({type:"SET_LOADED",payload:!0})}))}),[]),Object(n.useEffect)((function(){if(console.log("State updated ",o),o.stateLoaded){console.log("PERSISTING");o.datasets,o.tagList,o.categories}}),[o]),r.a.createElement(b.Provider,{value:[o,l]},t)}),null,r.a.createElement(C,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[22,1,2]]]);
//# sourceMappingURL=main.b2f8b8c9.chunk.js.map