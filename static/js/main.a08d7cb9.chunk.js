(this["webpackJsonpnew-york-open-data-explorer"]=this["webpackJsonpnew-york-open-data-explorer"]||[]).push([[0],{47:function(e,t,a){e.exports=a(99)},54:function(e,t,a){},64:function(e,t,a){},68:function(e,t,a){},69:function(e,t,a){},73:function(e,t,a){},92:function(e,t,a){},93:function(e,t,a){},97:function(e,t,a){},99:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(38),c=a.n(r),o=(a(52),a(53),a(54),a(10)),u=a(15),i=a(29),s=a(2),d=(a(64),a(3)),m=a(9),E=a(41),v=a(21),f=a.n(v),p="https://api.us.socrata.com/api/catalog/v1?domains=data.cityofnewyork.us&search_context=data.cityofnewyork.us";function g(e){var t,a=arguments;return f.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:100,n.abrupt("return",fetch("".concat(p,"&offset=").concat(e*t,"&limit=").concat(t)).then((function(e){return e.json()})));case 2:case"end":return n.stop()}}))}function h(e){return new Set([].concat(Object(d.a)(e.resource.columns_name),Object(d.a)(e.resource.columns_field_name)))}function b(e,t){var a=h(t),n=new Set(Object(d.a)(e).filter((function(e){return a.has(e)})));return Array.from(n)}var O=new E.a("SocrataCache");O.version(1).stores({SocrataCache:"id"});var y=Object(n.createContext)(),j={datasets:[],tagList:[],categories:[],stateLoaded:!1},C=function(e,t){var a=t.type,n=t.payload;switch(a){case"UPDATE_OPEN_DATASET_MANIFEST":return Object(m.a)({},e,{datasets:n});case"UPDATE_TAGS":return Object(m.a)({},e,{tagList:n});case"UPDATE_CATEGORIES":return Object(m.a)({},e,{categories:n});case"HYDRATE_STATE":return Object(m.a)({},e,{},n);case"SET_LOADED":return Object(m.a)({},e,{stateLoaded:!0});default:return e}},_=function(){return Object(n.useContext)(y)};function N(e){var t=_(),a=Object(s.a)(t,1)[0].datasets;return console.log(e),Object(n.useMemo)((function(){return e?function(e,t){var a=h(e);return t.map((function(e){return{dataset:e,joinableColumns:b(a,e)}})).filter((function(t){return t.joinableColumns.length>0&&t.dataset.resource.id!==e.resource.id}))}(e,a):[]}),[e,a])}function w(e){var t=e.tags,a=e.term,l=e.categories,r=e.ids,c=_(),o=Object(s.a)(c,1)[0].datasets;return Object(n.useMemo)((function(){var e=Object(d.a)(o);return r?e.filter((function(e){return r.includes(e.resource.id)})):(t&&t.length>0&&(console.log("applting"),e=e.filter((function(e){return e.classification.domain_tags.filter((function(e){return t.includes(e)})).length>0}))),l&&l.length>0&&(e=e.filter((function(e){return e.classification.categories.filter((function(e){return l.includes(e)})).length>0}))),a&&a.length>0&&(e=e.filter((function(e){return e.resource.name.toLowerCase().includes(a.toLowerCase())}))),console.log("after term ",e.length),console.log("return size ",e.length),e)}),[o,r,t,l,a])}var T=Object(n.createContext)(),A={datasets:[],name:null},D=function(e,t){var a=t.type,n=t.payload;switch(a){case"ADD_TO_COLLECTION":return Object(m.a)({},e,{datasets:[].concat(Object(d.a)(e.datasets),[n])});case"REMOVE_FROM_COLLECTION":return Object(m.a)({},e,{datasets:e.datasets.filter((function(e){return e!==n}))});case"SET_NAME":return Object(m.a)({},e,{name:n});default:return e}};function S(){var e=Object(n.useContext)(T),t=Object(s.a)(e,2),a=t[0],l=t[1];return[a,{addToCollection:function(e){return l({type:"ADD_TO_COLLECTION",payload:e})},removeFromCollection:function(e){return l({type:"REMOVE_FROM_COLLECTION",payload:e})},setName:function(e){return l({type:"SET_NAME",payload:e})}}]}a(68);function k(e){var t=e.categories,a=e.selected,n=e.onChange;return l.a.createElement("div",{className:"category-selector"},l.a.createElement("h2",null,"Categories"),l.a.createElement("ul",{className:"category-list"},t.map((function(e){return l.a.createElement("li",{key:e,onClick:function(){return function(e){var t=a.includes(e)?a.filter((function(t){return t!==e})):[].concat(Object(d.a)(a),[e]);n(t)}(e)},className:"category-buttons ".concat(a&&a.includes(e)?"selected":"")},e)}))),a&&a.length>0&&l.a.createElement("button",{type:"button",onClick:function(){n([])}},"clear"))}a(69);var L=a(42),M=a.n(L);function x(e){var t=e.html,a=e.className,n=M.a.sanitize(t);return l.a.createElement("div",{className:a,dangerouslySetInnerHTML:{__html:n}})}function I(e){var t=e.dataset,a=e.onAddToCollection,n=e.onRemoveFromCollection,r=e.inCollection;return console.log(r),l.a.createElement("div",{className:"dataset",key:t.resource.id},l.a.createElement("h4",{className:"dataset-title"},l.a.createElement(o.Link,{to:"/dataset/".concat(t.resource.id)},t.resource.name),a&&l.a.createElement("button",{type:"button",onClick:function(){return r?n(t.resource.id):a(t.resource.id)}},r?"Remove from collection":"Add to collection")),l.a.createElement(x,{className:"dataset-description",html:t.resource.description}),l.a.createElement("p",{className:"dataset-tags"},t.classification.domain_tags.join(", ")))}var R=a(43),P=a.n(R);a(73);function U(e){var t=e.tags,a=e.selected,n=e.onChange;return l.a.createElement("div",{className:"tag-selector"},l.a.createElement("h2",null,"Tags"),t&&l.a.createElement("ul",{className:"tag-list"},t.map((function(e){return l.a.createElement("li",{className:a.includes(e)?"selected":"",onClick:function(){return function(e){console.log("old tags ",a);var t=a.includes(e)?a.filter((function(t){return t!==e})):[].concat(Object(d.a)(a),[e]);console.log("new tags ",t),n(t)}(e)},key:e},e)}))),a.length>0&&l.a.createElement("button",{type:"button",onClick:function(){n([])}},"clear"))}function F(){var e=function(){var e=_();return Object(s.a)(e,1)[0].categories}(),t=function(){var e=_();return Object(s.a)(e,1)[0].tagList}(),a=Object(n.useState)([]),r=Object(s.a)(a,2),c=r[0],u=r[1],i=Object(n.useState)([]),d=Object(s.a)(i,2),m=d[0],E=d[1],v=Object(n.useState)(""),f=Object(s.a)(v,2),p=f[0],g=f[1],h=S(),b=Object(s.a)(h,2),O=b[0],y=b[1],j=y.addToCollection,C=y.removeFromCollection,N=w({tags:c,categories:m,term:p}),T=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=Object(n.useMemo)((function(){return e.length}),[e]),r=Object(n.useState)(0),c=Object(s.a)(r,2),o=c[0],u=c[1];Object(n.useEffect)((function(){u(0)}),[e]);var i=Math.ceil(a/t),d=l.a.createElement(P.a,{previousLabel:"previous",nextLabel:"next",breakLabel:"...",breakClassName:"break-me",pageCount:i.length,onPageChange:function(e){var t=e.selected;u(t)},containerClassName:"pagination",subContainerClassName:"pages pagination",activeClassName:"active"}),m=Object(n.useMemo)((function(){return e.slice(o*t,(o+1)*t)}),[t,o,e]);return[m,{pageButtons:d}]}(N),A=Object(s.a)(T,2),D=A[0],L=A[1].pageButtons;return l.a.createElement("div",{className:"home-page"},l.a.createElement("div",{className:"categories"},l.a.createElement(k,{categories:e,onChange:E,selected:m})),l.a.createElement("div",{className:"tags"},l.a.createElement(U,{tags:t,selected:c,onChange:u})),l.a.createElement("div",{className:"datasets"},l.a.createElement("h2",null,"Datasets (",D.length," / ",N.length," )"),l.a.createElement("div",{className:"search"},l.a.createElement("input",{type:"text",onChange:function(e){return g(e.target.value)},value:p,placeholder:"search"}),O.datasets.length>0&&l.a.createElement(o.Link,{to:"/collection/new"},"Create Collection (",O.datasets.length,")")),l.a.createElement("ul",{className:"dataset-list"},D.map((function(e){return l.a.createElement(I,{dataset:e,inCollection:O.datasets.includes(e.resource.id),onAddToCollection:j,onRemoveFromCollection:C})}))),l.a.createElement("div",null,L)))}var Y=a(44),B=a.n(Y),G=a(32),J=a.n(G),z=a(23),H=a(6),V=a(8),q=a(22),W=(a(92),function(e){return B()(e).format("MMMM DD, YYYY")});function $(e){var t,a,n,r,c,u,i,d,m,E,v,f=function(e){var t=_();return Object(s.a)(t,1)[0].datasets.find((function(t){return t.resource.id===e}))}(e.match.params.datasetID),p=N(f),g=null===f||void 0===f?void 0:f.resource,h=null===g||void 0===g?void 0:g.page_views,b=null===f||void 0===f?void 0:f.classification,O=null===b||void 0===b?void 0:b.domain_metadata,y=null===O||void 0===O?void 0:null===(t=O.find((function(e){var t=e.key,a=e.value;return"Update_Automation"===t&&"No"===a})))||void 0===t?void 0:t.value,j=null===O||void 0===O?void 0:null===(a=O.find((function(e){return"Update_Update-Frequency"===e.key})))||void 0===a?void 0:a.value,C=null===O||void 0===O?void 0:null===(n=O.find((function(e){return"Dataset-Information_Agency"===e.key})))||void 0===n?void 0:n.value;return l.a.createElement(q.a,{fluid:!0,className:"dataset-page"},f?l.a.createElement(q.a,{fluid:!0},l.a.createElement(H.a,{fluid:!0,className:"dataset-header"},l.a.createElement("h1",null,"Dataset: ",null===g||void 0===g?void 0:g.name),l.a.createElement(V.a,null,l.a.createElement(x,{className:"dataset-description",html:null===g||void 0===g?void 0:g.description}))),l.a.createElement(H.a,{fluid:!0},l.a.createElement(V.a,{fluid:!0},l.a.createElement(H.a,{fluid:!0},l.a.createElement(q.a,{fluid:!0},l.a.createElement(H.a,{fluid:!0},l.a.createElement(V.a,null,l.a.createElement("dt",null,"Updated"),l.a.createElement("dd",null,W(null===g||void 0===g?void 0:g.updatedAt)))),l.a.createElement(H.a,{fluid:!0},l.a.createElement(V.a,null,l.a.createElement("dt",null,"Data Last Updated"),l.a.createElement("dd",null,W(null===g||void 0===g?void 0:g.updatedAt))),l.a.createElement(V.a,null,l.a.createElement("dt",null,"Metadata Last Updated"),l.a.createElement("dd",null,W(null===g||void 0===g?void 0:g.metadata_updated_at)))),l.a.createElement(H.a,{fluid:!0},l.a.createElement(V.a,null,l.a.createElement("dt",null,"Date Created"),l.a.createElement("dd",null,W(null===g||void 0===g?void 0:g.createdAt)))))),l.a.createElement(H.a,{fluid:!0},(null===h||void 0===h?void 0:h.page_views_total)?l.a.createElement(V.a,null,l.a.createElement("dt",null,"Views"),l.a.createElement("dd",null,null===h||void 0===h?void 0:h.page_views_total)):null,(null===f||void 0===f?void 0:null===(r=f.resource)||void 0===r?void 0:r.download_count)?l.a.createElement(V.a,null,l.a.createElement("dt",null,"Downloads"),l.a.createElement("dd",null,null===f||void 0===f?void 0:null===(c=f.resource)||void 0===c?void 0:c.download_count)):null),l.a.createElement(H.a,{fluid:!0},l.a.createElement(V.a,null,l.a.createElement("dt",null,"Dataset Owner"),l.a.createElement("dd",null,null===f||void 0===f?void 0:null===(u=f.owner)||void 0===u?void 0:u.display_name)),l.a.createElement(V.a,null,l.a.createElement("dt",null,"Columns"),l.a.createElement("dd",null,l.a.createElement("ul",null,null===f||void 0===f?void 0:null===(i=f.resource)||void 0===i?void 0:null===(d=i.columns_name)||void 0===d?void 0:d.map((function(e,t){var a;return l.a.createElement("li",{key:t},e," : ",null===f||void 0===f?void 0:null===(a=f.resource)||void 0===a?void 0:a.columns_datatype[t])}))))))),l.a.createElement(V.a,null,l.a.createElement(H.a,null,l.a.createElement("h3",null,"Update Information"),l.a.createElement(z.a,{striped:!0,borderless:!0},l.a.createElement("tbody",null,j?l.a.createElement("tr",null,l.a.createElement("td",null,"Update Frequency"),l.a.createElement("td",null,l.a.createElement("span",null,j))):null,l.a.createElement("tr",null,l.a.createElement("td",null,"Automation"),l.a.createElement("td",null,l.a.createElement("span",null,"Yes"!==y?"No":"Yes"))),l.a.createElement("tr",null,l.a.createElement("td",null,"Date Made Public"),l.a.createElement("td",null,l.a.createElement("span",null,W(null===f||void 0===f?void 0:null===(m=f.resource)||void 0===m?void 0:m.publication_date))))))),l.a.createElement(H.a,null,l.a.createElement("h3",null,"Dataset Information"),l.a.createElement(z.a,{striped:!0,borderless:!0},l.a.createElement("tbody",null,C?l.a.createElement("tr",null,l.a.createElement("td",null,"Agency"),l.a.createElement("td",null,l.a.createElement("span",null,C))):null))),l.a.createElement(H.a,null,l.a.createElement("h3",null,"Topics"),l.a.createElement(z.a,{striped:!0,borderless:!0},l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",null,"Category"),l.a.createElement("td",null,(null===b||void 0===b?void 0:b.domain_category)?J()(null===b||void 0===b?void 0:b.domain_category):l.a.createElement("span",{className:"italics"},"This dataset does not have a category"))),l.a.createElement("tr",null,l.a.createElement("td",null,"Tags"),l.a.createElement("td",null,(null===b||void 0===b?void 0:null===(E=b.domain_tags)||void 0===E?void 0:E.length)?null===b||void 0===b?void 0:null===(v=b.domain_tags)||void 0===v?void 0:v.map((function(e){return J()(e)})).join(", "):l.a.createElement("span",{className:"italics"},"This dataset does not have any tags")))))),l.a.createElement(H.a,{fluid:!0},l.a.createElement("div",{className:"dataset-joins"},l.a.createElement("h3",null,"Can be joined with"),l.a.createElement("ul",{style:{overflowY:"auto"}},p.map((function(e,t){var a,n;return l.a.createElement("li",{key:t},l.a.createElement("p",null,l.a.createElement(o.Link,{to:"/dataset/".concat(null===(a=e.resource)||void 0===a?void 0:a.id)},null===(n=e.resource)||void 0===n?void 0:n.name," ")," ","on :"),l.a.createElement("p",null," ",e.joinableColumns.join(", ")))})))))))):l.a.createElement("h1",null,"Loading..."))}var K=a(46),Q=(a(93),a(101)),X=a(102),Z=a(103),ee=a(104),te=a(105),ae=a(106);function ne(e){var t=e.match.params,a=t.name,n=t.datasetIDs,r=window.location.href,c=w({ids:n.split(",")}),o=Object(K.useCopyClipboard)("".concat(r)),u=Object(s.a)(o,2),i=u[0],d=u[1];return l.a.createElement("div",{className:"collections-page"},l.a.createElement("h1",null,a),c.map((function(e){return l.a.createElement(I,{dataset:e})})),l.a.createElement("div",{className:"share"},"Share this collection:",l.a.createElement("p",null,l.a.createElement(Q.a,{url:r},l.a.createElement(X.a,null))," ",l.a.createElement(Z.a,{url:r},l.a.createElement(ee.a,null)),l.a.createElement(te.a,{url:r},l.a.createElement(ae.a,null))),l.a.createElement("p",null,"Share link ",r," ",l.a.createElement("button",{type:"button",onClick:d}," ",i?"Copied":"Copy"," "))))}a(97);function le(e){var t=e.history,a=S(),n=Object(s.a)(a,2),r=n[0],c=n[1].setName,o=w({ids:r.datasets});return l.a.createElement("div",{className:"create-collection-modal"},l.a.createElement("h3",null,"Create collection with the following datasets"),l.a.createElement("ul",null,o.map((function(e){return l.a.createElement("li",null,e.resource.name)}))),l.a.createElement("input",{type:"text",placeholder:"Name",value:r.name,onChange:function(e){return c(e.target.value)}}),l.a.createElement("button",{type:"submit",onClick:function(){return function(e){var a="/collection/".concat(e.name,"/").concat(e.datasets.join(","));t.push(a)}(r)}},"Create"))}a(98);var re=function(){return l.a.createElement(o.BrowserRouter,{basename:"/NewYorkOpenDataExplorer"},l.a.createElement("div",{className:"App"},l.a.createElement(u.d,{path:"/",exact:!0,component:F}),l.a.createElement(u.d,{path:"/dataset/:datasetID",exact:!0,component:$}),l.a.createElement(u.d,{path:"/collection/:name/:datasetIDs",exact:!0,component:ne}),l.a.createElement(i.ModalRoute,{path:"/collection/new",parentPath:"/",component:le})),l.a.createElement(i.ModalContainer,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(l.a.createElement((function(e){var t=e.children,a=Object(n.useReducer)(C,j),r=Object(s.a)(a,2),c=r[0],o=r[1];Object(n.useEffect)((function(){O.SocrataCache.get(1).then((function(e){if(e){var t=JSON.parse(e.data);o({type:"HYDRATE_STATE",payload:Object(m.a)({},j,{},t,{cache_loaded:!0})})}else(function(){var e,t,a;return f.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,f.a.awrap(g(0,1));case 2:return e=n.sent,t=e.resultSetSize,a=Math.ceil(t/100),n.abrupt("return",Promise.all(Object(d.a)(Array(a)).map((function(e,t){return g(t).then((function(e){return e.results}))}))).then((function(e){return e.reduce((function(e,t){return[].concat(Object(d.a)(t),Object(d.a)(e))}),[])})));case 6:case"end":return n.stop()}}))})().then((function(e){var t=function(e){var t=e.reduce((function(e,t){return[].concat(Object(d.a)(e),Object(d.a)(t.classification.domain_tags?t.classification.domain_tags:[]))}),[]);return Array.from(new Set(t))}(e),a=function(e){var t=e.reduce((function(e,t){return[].concat(Object(d.a)(e),Object(d.a)(t.classification.categories?t.classification.categories:[]))}),[]);return Array.from(new Set(t))}(e);o({type:"UPDATE_OPEN_DATASET_MANIFEST",payload:e}),o({type:"UPDATE_TAGS",payload:t}),o({type:"UPDATE_CATEGORIES",payload:a}),o({type:"SET_LOADED"})}))}))}),[]);var u=c.datasets,i=c.tagList,E=c.categories,v=c.stateLoaded;return Object(n.useEffect)((function(){v&&O.SocrataCache.put({data:JSON.stringify({datasets:u,tagList:i,categories:E}),id:1})}),[u,i,E,v]),l.a.createElement(y.Provider,{value:[c,o]},t)}),null,l.a.createElement((function(e){var t=e.children,a=Object(n.useReducer)(D,A),r=Object(s.a)(a,2),c=r[0],o=r[1];return l.a.createElement(T.Provider,{value:[c,o]},t)}),null,l.a.createElement(re,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[47,1,2]]]);
//# sourceMappingURL=main.a08d7cb9.chunk.js.map